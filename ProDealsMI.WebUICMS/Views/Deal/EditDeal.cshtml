@model ProDealsMI.Core.ViewModels.EditDealViewModel

@{
    ViewBag.Title = "EditDeal";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
@using (Html.BeginForm("SaveDealDetails", "Deal", FormMethod.Post))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.Id)

        <div class="form-group">
            @Html.LabelFor(model => model.HeadLine, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.HeadLine, new { htmlAttributes = new { @class = "form-control col-md-10" } })
                @Html.ValidationMessageFor(model => model.HeadLine, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.DealValue, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.DealValue, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.DealValue, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.AnnouncedDate, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.AnnouncedDate, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.AnnouncedDate, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.PublishedDate, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.PublishedDate, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.PublishedDate, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Countries, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(x => Model.CountryId, new SelectList(Model.Countries, "Value", "Text"), htmlAttributes: new { @class = "form-control", id = "Country" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Status, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(x => Model.DealStatusId, new SelectList(Model.Status, "Value", "Text"), htmlAttributes: new { @class = "form-control", id = "Status" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.DealTypes, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(x => Model.DealTypeId, new SelectList(Model.DealTypes, "Value", "Text"), htmlAttributes: new { @class = "form-control", id = "DealTypes" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.PrimaryTreeView, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.Label(Model.FullTaxonamyPath, htmlAttributes: new { @class = "", @id = "fulltaxonomy" })
                @Html.HiddenFor(model => model.FullTaxonomyId, new { @id = "FullTaxonomyId" })
                <span class="glyphicon glyphicon-pencil" data-toggle="modal" data-target="#taxonomyModal"></span>
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.FullVericalTaxonomyPath, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Model.FullVericalTaxonomyPath
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Save" class="btn btn-default" />
            </div>
        </div>
    </div>
    <div class="modal fade" id="taxonomyModal" tabindex="-1" role="dialog" aria-labelledby="taxonomyModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taxonomyModalLabel">Taxonomy</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="height: 500px;overflow-y: scroll;max-height:450px">
                    <div id="Primarytaxonomy">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveTaxonomy">Save</button>
                </div>
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryjstree")
    <script>
        var SelectedTaxonomy = '';
        var SelectedTaxonomyId = '';
        $(function () {

            $('#Primarytaxonomy').jstree({
                'core': {
                    'data': {
                        'url': '@Url.Action("Nodes")',
                        'data': function (node) {
                            return { 'id': node.id };
                        }
                    }
                }
            });


            $('#Primarytaxonomy').on('changed.jstree', function (e, data) {
                debugger;
                SelectedTaxonomy = data.node.original.li_attr;
                SelectedTaxonomyId = data.node.id;
            }).jstree();
        });
        $('#saveTaxonomy').on('click', function () {
            debugger;
            $('#fulltaxonomy').text(SelectedTaxonomy);
            $('#FullTaxonomyId').val(SelectedTaxonomyId);
            $('#taxonomyModal').modal('hide');
        })
    </script>
}

